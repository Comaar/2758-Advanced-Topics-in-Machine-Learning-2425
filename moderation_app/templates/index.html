<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PDF Moderation Tool</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h1>PDF Moderation Tool</h1>
    <div class="container">
        <form id="moderationForm" enctype="multipart/form-data">
            <label for="pdf_input">Upload a PDF:</label>
            <input type="file" name="pdf_input" id="pdf_input" accept=".pdf" required>
            <button type="submit">Moderate PDF</button>
        </form>

        <div id="progressContainer" style="display:none;">
            <div id="progressBar">0%</div>
            <p id="progressText">Waiting...</p>
        </div>

        <div id="resultsContainer"></div>
    </div>

    <script>
    const form = document.getElementById("moderationForm");
    const progressBar = document.getElementById("progressBar");
    const progressText = document.getElementById("progressText");
    const progressContainer = document.getElementById("progressContainer");
    const resultsContainer = document.getElementById("resultsContainer");

    form.addEventListener("submit", function (e) {
        e.preventDefault();
        const formData = new FormData(form);
        progressContainer.style.display = "block";
        progressBar.style.width = "0%";
        progressBar.textContent = "0%";
        progressText.textContent = "Uploading...";

        fetch("/moderate", {
            method: "POST",
            body: formData
        })
        .then(response => response.text())
        .then(html => {
            resultsContainer.innerHTML = html;
            progressBar.style.width = "100%";
            progressBar.textContent = "100%";
            progressText.textContent = "Done!";
            clearInterval(polling);
        });

        const polling = setInterval(() => {
            fetch("/progress")
                .then(res => res.json())
                .then(data => {
                    progressBar.style.width = data.percent + "%";
                    progressBar.textContent = data.percent + "%";
                    progressText.textContent = data.message;
                });
        }, 500);
    });
    </script>
</body>
</html>